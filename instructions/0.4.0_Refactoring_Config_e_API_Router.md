Refactoring: Configurazione Centralizzata e API Router per cliPy
Versione: 1.0
Progetto: cliPy
Autore: AI Engineer
Obiettivo: Eseguire un refactoring della codebase per introdurre una struttura più robusta e scalabile. Centralizziamo la configurazione e modularizziamo gli endpoint usando APIRouter.
1. Introduzione alla Gestione della Configurazione
Per gestire le impostazioni in modo pulito, usiamo pydantic-settings.
Aggiorna requirements.txt:
Generated text
fastapi
uvicorn[standard]
pydantic-settings

# Testing
pytest
httpx
Use code with caution.
Text
2. Creazione del File di Configurazione
Le impostazioni dell'applicazione ora vivranno qui.
Popola il file src/core/config.py:
Generated python
from pydantic_settings import BaseSettings, SettingsConfigDict

class Settings(BaseSettings):
    """
    Gestisce le impostazioni dell'applicazione, caricandole da variabili d'ambiente.
    """
    # Carica le variabili dal file .env
    model_config = SettingsConfigDict(env_file=".env", env_file_encoding="utf-8")

    # Impostazioni dell'applicazione
    PROJECT_NAME: str = "cliPy"
    PROJECT_VERSION: str = "0.1.0"
    PROJECT_DESCRIPTION: str = "Un bot Python di eccellenza, costruito con un'architettura solida."

# Istanza singola delle impostazioni, da importare nel resto dell'applicazione
settings = Settings()
Use code with caution.
Python
3. Creazione del Primo API Router
Spostiamo l'endpoint di health check in un modulo dedicato.
Crea e popola il file src/api/health.py:
Generated python
from fastapi import APIRouter

router = APIRouter()

@router.get("/", tags=["Health Check"])
def read_root():
    """
    Endpoint di health check per verificare che il servizio sia attivo.
    """
    return {"status": "ok", "project_name": "cliPy"}
Use code with caution.
Python
4. Refactoring del File main.py
main.py ora assembla i pezzi, senza contenere logica di business.
Aggiorna src/main.py:
Generated python
from fastapi import FastAPI
from src.core.config import settings
from src.api import health

# Inizializzazione dell'applicazione FastAPI usando le impostazioni centralizzate
app = FastAPI(
    title=settings.PROJECT_NAME,
    version=settings.PROJECT_VERSION,
    description=settings.PROJECT_DESCRIPTION,
)

# Includi i router dei moduli API
app.include_router(health.router)
Use code with caution.
Python
Nota: Il nostro test (tests/test_api/test_main.py) continuerà a funzionare senza modifiche, poiché from src.main import app è ancora valido e l'endpoint / è ancora esposto, anche se tramite un router.
